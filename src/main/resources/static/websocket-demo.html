<!DOCTYPE html>
<html>
<head>
    <title>ShambaBora Real-time Communication Demo</title>
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .message { background: #f0f0f0; padding: 10px; margin: 5px 0; border-radius: 5px; }
        .input-group { margin: 10px 0; }
        input, textarea, button { padding: 8px; margin: 5px; }
        .status { color: green; font-weight: bold; }
        .error { color: red; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ShambaBora Real-time Communication Demo</h1>
        
        <div class="input-group">
            <input type="text" id="username" placeholder="Enter your username" />
            <button onclick="connect()">Connect</button>
            <button onclick="disconnect()">Disconnect</button>
        </div>
        
        <div class="input-group">
            <input type="text" id="messageInput" placeholder="Type your message" />
            <button onclick="sendMessage()">Send Message</button>
        </div>
        
        <div class="input-group">
            <input type="number" id="postId" placeholder="Post ID" />
            <button onclick="likePost()">Like Post</button>
            <button onclick="unlikePost()">Unlike Post</button>
        </div>
        
        <div class="input-group">
            <input type="number" id="commentPostId" placeholder="Post ID for comment" />
            <textarea id="commentInput" placeholder="Type your comment"></textarea>
            <button onclick="addComment()">Add Comment</button>
        </div>
        
        <div id="status" class="status">Disconnected</div>
        <div id="messages"></div>
    </div>

    <script>
        let stompClient = null;
        let username = null;

        function connect() {
            username = document.getElementById('username').value;
            if (!username) {
                alert('Please enter a username');
                return;
            }

            const socket = new SockJS('/ws');
            stompClient = Stomp.over(socket);
            
            stompClient.connect({}, function (frame) {
                console.log('Connected: ' + frame);
                document.getElementById('status').textContent = 'Connected';
                document.getElementById('status').className = 'status';
                
                // Subscribe to general messages
                stompClient.subscribe('/topic/public', function (message) {
                    showMessage(JSON.parse(message.body));
                });
                
                // Subscribe to user-specific messages
                stompClient.subscribe('/user/queue/messages', function (message) {
                    showMessage(JSON.parse(message.body));
                });
                
                // Subscribe to post updates
                stompClient.subscribe('/topic/post.*', function (message) {
                    showMessage(JSON.parse(message.body));
                });
                
                // Subscribe to group updates
                stompClient.subscribe('/topic/group.*', function (message) {
                    showMessage(JSON.parse(message.body));
                });
                
                // Notify that user joined
                stompClient.send("/app/chat.addUser", {}, JSON.stringify(username));
            }, function (error) {
                console.log('Error: ' + error);
                document.getElementById('status').textContent = 'Connection Error';
                document.getElementById('status').className = 'error';
            });
        }

        function disconnect() {
            if (stompClient !== null) {
                stompClient.disconnect();
            }
            document.getElementById('status').textContent = 'Disconnected';
            document.getElementById('status').className = 'status';
        }

        function sendMessage() {
            const messageInput = document.getElementById('messageInput');
            const message = messageInput.value;
            if (message && stompClient) {
                const messageObj = {
                    senderId: 1, // Demo user ID
                    recipientId: 2, // Demo recipient ID
                    content: message,
                    messageType: 'TEXT'
                };
                stompClient.send("/app/chat.sendMessage", {}, JSON.stringify(messageObj));
                messageInput.value = '';
            }
        }

        function likePost() {
            const postId = document.getElementById('postId').value;
            if (postId && stompClient) {
                const likeRequest = {
                    postId: parseInt(postId),
                    userId: 1,
                    action: 'like'
                };
                stompClient.send("/app/post.like", {}, JSON.stringify(likeRequest));
            }
        }

        function unlikePost() {
            const postId = document.getElementById('postId').value;
            if (postId && stompClient) {
                const likeRequest = {
                    postId: parseInt(postId),
                    userId: 1,
                    action: 'unlike'
                };
                stompClient.send("/app/post.like", {}, JSON.stringify(likeRequest));
            }
        }

        function addComment() {
            const postId = document.getElementById('commentPostId').value;
            const comment = document.getElementById('commentInput').value;
            if (postId && comment && stompClient) {
                const commentRequest = {
                    postId: parseInt(postId),
                    userId: 1,
                    content: comment
                };
                stompClient.send("/app/post.comment", {}, JSON.stringify(commentRequest));
                document.getElementById('commentInput').value = '';
            }
        }

        function showMessage(message) {
            const messagesDiv = document.getElementById('messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message';
            messageDiv.textContent = JSON.stringify(message, null, 2);
            messagesDiv.appendChild(messageDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        // Allow Enter key to send message
        document.getElementById('messageInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
    </script>
</body>
</html>
